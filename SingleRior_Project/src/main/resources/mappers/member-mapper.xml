<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="memberMapper">

	<resultMap type="Member" id="MemberResultSet">
		<id column="MEMBER_ID" property="memberId"/>
		<result column="MEMBER_PWD" property="memberPwd"/>
		<result column="MEMBER_NAME" property="memberName"/>
		<result column="NICKNAME" property="nickName"/>
		<result column="PHONE" property="phone"/>
		<result column="EMAIL" property="email"/>
		<result column="ADDRESS" property="address"/>
		<result column="STATUS" property="memberStatus"/>
		<result column="AUTHORITY" property="memberAuthority"/>
	</resultMap>

	<select id="login" resultMap="MemberResultSet">
		select * 
		from member
			where MEMBER_ID=#{memberId}
				and STATUS = 'Y'
	</select>
	
	<!--  아이디 중복확인 -->
	<select id ="checkId" resultType="_int">
		select count(*)
		from member
		where member_id = #{memberId}
	</select>
	
	<!-- 닉네임 중복확인 -->
	<select id ="checkNickName" resultType="_int">
		select count(*)
		from member
		where nickname = #{nickName}
	</select>
	
	<!-- email 중복확인 -->
	<select id ="checkEmailConfirm" resultType="_int">
		select count(*)
		from member
		where email = #{email} and status = 'Y'
	</select>
	
	<insert id = "insertMember">
		insert into member
		values(#{memberId}, #{memberPwd}, #{memberName}, 
		<if test="nickName == null">
			null,
		</if>
		<if test="nickName != null">
			#{nickName},
		</if>
		<if test="phone == null">
			null,
		</if>
		<if test="phone != null">
			#{phone},
		</if>
		 #{email}, 
		 <if test="address == null">
			null,
		</if>
		<if test="address != null">
			#{address},
		</if>
		 sysdate, sysdate, default, default)
	</insert>
	
	<select id ="findId" resultType="string">
		select member_id
		from member
		where member_name = #{memberName} and email = #{email}
	</select>
	
	<select id ="findPwd" resultType="_int">
		select count(*)
		from member
		where member_id = #{memberId} and email = #{email}
	</select>
	
	<!--  이메일로 새로운 비밀번호 발급된거 넣어주기 -->
	<update id="changePwd">
		update member
		set member_pwd = #{memberPwd}
		where email = #{email}
			and member_id = #{memberId}
			and status = 'Y'
	</update>
	
	<!-- 회원정보 수정 -->
	<update id="updateMember">
		update member
		set 
		nickName = #{nickName},
		<if test="phone != null">
			phone = #{phone},
		</if>
		<if test="phone == null">
			phone = null,
		</if>
		<if test="address != null">
			address = #{address},
		</if>
		<if test="address == null">
			address = null,
		</if>
		modifyDate = sysdate
		<if test="memberPwd != null">
			,member_Pwd = #{memberPwd}
		</if>
		where
			 member_id = #{memberId} and status = 'Y'
	</update>
	
	<!-- 프로필 사진 유무 확인 -->
	<select id="getProfilePhotoCount" resultType="_int">
		select count(*)
		from IMG_REPOSITORY
		where img_key = #{memberId}
	</select>
	
	<insert id="insertProfile">
		insert into IMG_REPOSITORY
		values(SingleRior_aid, #{imgOriginalName}, #{imgRename}, sysdate, sysdate, default, #{imgKey}, #{imgPath}, #{boardType}, 0)
	</insert>
	
	<update id="updateProfile">
		update img_repository
		set img_name = #{imgOriginalName}, IMG_SERVER_NAME = #{imgRename}, IMG_MODIFY_DATE = sysdate, IMG_PATH = #{imgPath}
		where img_key =  #{imgKey}
	</update>
	
	<select id="selectProfile" resultMap="attachmentResultSet">
		select *
		from img_repository
		where img_key = #{memberId}
	</select>
	
	<resultMap type="Attachment" id="attachmentResultSet">
		<id property="imgNo" column="IMG_NO"/>
		<result property="imgOriginalName" column="IMG_NAME"/>
		<result property="imgRename" column="IMG_SERVER_NAME"/>
		<result property="imgCreateDate" column="IMG_CREATE_DATE"/>
		<result property="imgModifyDate" column="IMG_CREATE_DATE"/>
		<result property="imgKey" column="IMG_KEY"/>
		<result property="imgPath" column="IMG_PATH"/>
		<result property="imgStatus" column="IMG_STATUS"/>
		<result property="level" column="IMG_LEVEL"/>
		<result property="boardType" column="IMG_B_TYPE"/>
	</resultMap>
	
	<delete id="deleteProfile">
		delete from img_repository
		where img_key = #{memberId}
	</delete>
	
	<update id="deleteMember">
		update member
		set status = 'N'
		where member_id = #{memberId}
	</update>
	
	<delete id="deleteKakaoMember">
		delete from member
		where member_id = #{memberId}
	</delete>
	
	<!-- 내가 쓴 글 리스트 카운트 -->
	<select id="getMyContentListCount" resultType="_int">
		select count(*)
		from board
		where board_writer = #{memberId}
		<if test='category != "전체"'>
			<if test='category == "싱글벙글"'>
				and board_type = 2
			
			</if>
			<if test='category == "씽씽마켓"'>
				and board_type = 3
			</if>
		</if>
		
	</select>
	
	<resultMap type="Board" id="boardResultSet">
		<id column="BOARD_NO" property="boardNo"/>
		<result column="BOARD_TYPE" property="boardType"/>
		<result column="BOARD_TITLE" property="boardTitle"/>
		<result column="BOARD_CONTENT" property="boardContent"/>
		<result column="CREATE_DATE" property="createDate"/>
		<result column="MODIFY_DATE" property="modifyDate"/>
		<result column="NOTICE_STATUS" property="noticeStatus"/>
		<result column="B_STATUS" property="status"/>
		<result column="BOARD_WRITER" property="writer"/>
		<result column="BOARD_COUNT" property="count"/>
	</resultMap>
	
	
	<select id="selectBoardList" resultMap="boardResultSet">
		select *
		from board
		where board_writer = #{memberId}
		<if test='category != "전체"'>
			<if test='category == "싱글벙글"'>
				and board_type = 2
			
			</if>
			<if test='category == "씽씽마켓"'>
				and board_type = 3
			</if>
		</if>
	</select>
	
	<select id="getLikeCount" resultType="_int">
		select count(*)
		from wishlist
		where board_no = #{boardNo}
	</select>
	
	<select id="getReplyCount" resultType="_int">
		select count(*)
		from reply
		where board_no = #{boardNo}
	</select>
</mapper>